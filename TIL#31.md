### 토큰 기반 인증 (Token-based Authentication)

#### 토큰 기반 인증은 왜, 그리고 언제 쓸까요?

세션 기반 인증은 서버(혹은 DB)에 유저 정보를 담는 인증 방식이었습니다. 서버에서는 유저가 민감하거나 제한된 정보를 요청할 때마다 "지금 요청을 보낸 유저에게 우리가 정보를 줘도 괜찮은가?"를 확인하기 위해 가지고 있는 세션 값과 일치하는지 확인합니다. 매 요청마다 데이터베이스를 살펴보는 것이 불편하고, 이 부담을 덜어내고 싶다면 어떤 방법이 있을까요? 이럴 때 사용할 수 있는 토큰 기반 인증 중 대표적인 JWT (JSON Web Token)에 대해서 알아봅시다.

#### 클라이언트에서 인증 정보 보관하기
토큰이 뭐죠? 라는 질문을 한다면 여러분들은 동전을 흔하게 떠올리실 수 있을 것 같습니다.

- 오락실 게임에 사용하는 토큰
- 행사에 입장하기 위해서 주최 측에서 나누어 준 토큰
- 놀이공원에 입장료를 내면 주는 토큰
위 토큰들은 공통적으로 나는 돈을 지불했고, 이 시설을 사용할 수 있어! 라는 메시지를 담고 있습니다. 이 토큰이 황금색으로 빛난다면 더 프리미엄 기능을 사용하게끔 만들었을 수도 있겠죠.

클라이언트에서 인증 정보를 보관하는 방법으로 토큰 기반 인증이 고안되었습니다. 클라이언트가 토큰을 가지고 있다면 보통의 다른(돈을 내지 않은) 유저들과는 다르게 서버에서 제공하는 다양한, 더 프리미엄한 기능을 요청할 수 있을 것입니다. 그런데 토큰을 클라이언트에 저장해도 정말 괜찮은 걸까요? 여러분들은 클라이언트는 XSS, CSRF 공격에 노출이 될 위험이 있으니 민감한 정보를 담고 있어서는 안된다는 것을 기억하실 것입니다. 그렇다면 "민감한 정보는 클라이언트에 담으면 안 된다면서, 인증에 사용되는 걸 클라이언트에 담는다고?"라는 의문이 드실 것입니다.

#### JWT의 종류

1. Access Token
2. Refresh Token
Access token은 보호된 정보들(유저의 이메일, 연락처, 사진 등)에 접근할 수 있는 권한부여에 사용합니다. 클라이언트가 처음 인증을 받게 될 때(로그인 시), access, refresh token 두 가지를 다 받지만, 실제로 권한을 얻는 데 사용하는 토큰은 access token입니다.

그럼 access token만 있으면 되는 것 아닌가요?

맞습니다. 권한을 부여받는 데엔 access token만 가지고 있으면 됩니다. 하지만 access token을 만약 악의적인 유저가 얻어냈다면 어떻게 될까요? 이 악의적인 유저는 자신이 00유저인 것 마냥 서버에 여러 가지 요청을 보낼 수 있습니다(만약 돈과 관련된 문제라면 큰일이 날 수 있겠네요!). 그렇기 때문에 access token에는 비교적 짧은 유효 기간 을 주어 탈취되더라도 오랫동안 사용할 수 없도록 하는 것이 좋습니다.

Access token의 유효기간이 만료된다면 refresh token을 사용하여 새로운 access token을 발급받습니다. 이때, 유저는 다시 로그인할 필요가 없습니다.

refresh token도 탈취 당한다면요?

유효기간이 긴 refresh token 마저 악의적인 유저가 얻어낸다면 큰 문제가 될 것입니다. 상당히 오랜 기간 동안 access token이 만료되면 다시 발급받으며 유저에게 피해를 입힐 수 있기 때문이죠. 그렇기 때문에 유저의 편의보다 정보를 지키는 것이 더 중요한 웹사이트들은 refresh token을 사용하지 않는 곳이 많습니다. 세상에 완벽한 보안은 없기 때문에 (있다면 쿠키, 세션, JWT, OAuth 등 다양한 방법들을 공부하지 않아도 되겠죠!) 각 방법들의 장단점을 참고하며 필요에 맞게 사용하는 것이 좋습니다.

